<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Omar Essilfie-Quaye">
  <meta name="description" content="A simulation to model a line following robot.  This is a project created by Omar Essilfie-Quaye on 15 March 2024.">
  <meta property="og:title" content="Line sim 3d">
  <meta property="og:description" content="A simulation to model a line following robot.  This is a project created by Omar Essilfie-Quaye on 15 March 2024.">
  <meta property="og:image" content="https://omareq.github.io/imgs/p_027.jpg">
  <meta property="og:url" content="https://omareq.github.io/line-sim-3d/">
  <meta property="og:site_name" content="Omar EQ Githubio">
  <meta property="og:locale" content="en_GB" />

  <script type="text/javascript" id="MathJax-script" async src="../libraries/mathjax3-es5-tex-chtml.js"> </script>
  <script language="javascript" type="text/javascript" src="../libraries/jquery-3.3.1.min.js"></script>
  <link rel="stylesheet" href="../libraries/bootstrap-4.0.0/css/bootstrap.min.css">
  <script src="../libraries/bootstrap-4.0.0/js/bootstrap.min.js"></script>
  <script language="javascript" type="text/javascript" src="../libraries/run_prettify.js"></script>

  <link type="text/css" rel="stylesheet" href="../main.css">

  <title>Line sim 3d</title>

</head>

<body style="width:100%; text-align:center">
  <div id="main">
    <section class="jumbotron jumbotron-main">
      <div class="container">
        <div class="row text-center">
          <h1>Line sim 3d</h1>
        </div>
        <div class="row text-center">
          <h4><i>By Omar Essilfie-Quaye</i></h4>
        </div>
      </div>
    </section>

    <section class="container">
      <div class="row">

        <div id="control-panel" class="col-sm-4" style="margin-bottom:10px; border: 2px solid purple; border-radius: 10px; visibility:hidden; display:none">
            <p style="font-weight: bold"> Control Panel <p>

              <div style="padding: 10px">

                <!-- Buttons -->
                <div style="margin: 10px;">
                <div id="pause-button" style=" display: inline-block"> </div>
                <div id="reset-button" style=" display: inline-block"> </div>
                </div>

                <!-- Algorithm dependent Code -->
                <div id="simulation-mode-selector" style="overflow: hidden;"></div>

                <!-- Simulation mode Debug (SM DEBUG) -->
                <div id="simulation-mode-debug" style="visibility: hidden;display:none">
                  <div>
                  <p><u>Debug Mode Selector</u></p>
                  <div id="sm-debug-selector" style="overflow: hidden;"> </div>
                  </div>
                </div> <!-- End SM ST-->

                <!-- Simulation mode line follow two sensor (SM LFTS) -->
                <div id="simulation-mode-line-follow-two-sensor" style="visibility:hidden;">
                  <b>Line Follow 2 Sensor Settings</b>

                  <div id="sm-lfts-show-grid"></div>
                  <div id="sm-lfts-load-room-json-button"></div>

                  <p><u>Light Sensor (LS)</u></p>
                  <div>
                  <div id="sm-lfts-sensor-separation-slider" style="display: inline-block"> </div>
                  <div id="sm-lfts-sensor-separation-val" style="display: inline-block"></div>
                  </div>

                  <div>
                  <div id="sm-lfts-sensor-radius-slider" style="display: inline-block"> </div>
                  <div id="sm-lfts-sensor-radius-val" style="display: inline-block"> </div>
                  </div>

                  <p><u>PD Control</u></p>
                  <div>
                  <div id="sm-lfts-pd-rotation-kp-slider" style="display: inline-block"> </div>
                  <div id="sm-lfts-pd-rotation-kp-val" style="display: inline-block"> </div>
                  </div>

                  <div>
                  <div id="sm-lfts-pd-rotation-kd-slider" style="display: inline-block"> </div>
                  <div id="sm-lfts-pd-rotation-kd-val" style="display: inline-block"> </div>
                  </div>

                  <div>
                  <div id="sm-lfts-pd-vel-slider" style="display: inline-block"> </div>
                  <div id="sm-lfts-pd-vel-val" style="display: inline-block"> </div>
                  </div>
                </div> <!-- End SM LFTS-->

                <!-- Simulation mode line follow three sensor (SM LFTS) -->
                <div id="simulation-mode-line-follow-three-sensor" style="visibility:hidden;display:none">
                  <b>Line Follow 3 Sensor Settings</b>

                  <div id="sm-lf3s-show-grid"></div>
                  <div id="sm-lf3s-load-room-json-button"></div>

                  <p><u>Light Sensor (LS)</u></p>
                  <div>
                  <div id="sm-lf3s-sensor-separation-slider" style="display: inline-block"> </div>
                  <div id="sm-lf3s-sensor-separation-val" style="display: inline-block"></div>
                  </div>

                  <div>
                  <div id="sm-lf3s-sensor-radius-slider" style="display: inline-block"> </div>
                  <div id="sm-lf3s-sensor-radius-val" style="display: inline-block"> </div>
                  </div>

                  <p><u>PD Control</u></p>
                  <div>
                  <div id="sm-lf3s-pd-rotation-kp-slider" style="display: inline-block"> </div>
                  <div id="sm-lf3s-pd-rotation-kp-val" style="display: inline-block"> </div>
                  </div>

                  <div>
                  <div id="sm-lf3s-pd-rotation-kd-slider" style="display: inline-block"> </div>
                  <div id="sm-lf3s-pd-rotation-kd-val" style="display: inline-block"> </div>
                  </div>

                  <div>
                  <div id="sm-lf3s-pd-vel-slider" style="display: inline-block"> </div>
                  <div id="sm-lf3s-pd-vel-val" style="display: inline-block"> </div>
                  </div>
                </div> <!-- End SM LFTS-->


                <!-- Simulation mode Line distance check (SM LDC) -->
                <div id="simulation-mode-line-distance-check" style="visibility: hidden;display:none">
                  <p><u>Light Sensor (LS)</u></p>
                  <div>
                  <div id="sm-ldc-sensor-radius-slider" style="display: inline-block"> </div>
                  <div id="sm-ldc-sensor-radius-val" style="display: inline-block"> </div>
                  </div>
                </div> <!-- End SM LDC-->

                <!-- Simulation mode Moving Tile (SM MT) -->
                <div id="simulation-mode-moving-tile" style="visibility: hidden;display:none">
                  <p><u>Light Sensor (LS)</u></p>
                  <div>
                  <div id="sm-mt-sensor-radius-slider" style="display: inline-block"> </div>
                  <div id="sm-mt-sensor-radius-val" style="display: inline-block"> </div>
                  </div>


                  <p><u>Tile</u></p>
                  <div>
                  <div id="sm-mt-tile-x-speed-slider" style="display: inline-block"> </div>
                    <div id="sm-mt-tile-x-speed-val" style="display: inline-block"> </div>
                    </div>

                    <div>
                    <div id="sm-mt-tile-y-speed-slider" style="display: inline-block"> </div>
                  <div id="sm-mt-tile-y-speed-val" style="display: inline-block"> </div>
                  </div>

                </div> <!-- End SM MT-->


                <!-- Simulation mode Static Tile (SM ST) -->
                <div id="simulation-mode-static-tile" style="visibility: hidden;display:none">
                  <p><u>Light Sensor (LS)</u></p>
                  <div>
                  <div id="sm-st-sensor-radius-slider" style="display: inline-block"> </div>
                  <div id="sm-st-sensor-radius-val" style="display: inline-block"> </div>
                  </div>

                  <p><u>Tile</u></p>
                  <div id="sm-st-tile-selector" style="overflow: hidden;"> </div>
                </div> <!-- End SM ST-->

                 <!-- Simulation mode room (SM room) -->
                <div id="simulation-mode-room" style="visibility: hidden;display:none">
                  <p><u>Light Sensor (LS)</u></p>
                  <div>
                  <div id="sm-room-sensor-radius-slider" style="display: inline-block"> </div>
                  <div id="sm-room-sensor-radius-val" style="display: inline-block"> </div>
                  </div>
                </div> <!-- End SM room-->

                <!-- Simulation mode map editor (SM ME) -->
                <div id="simulation-mode-map-editor" style="visibility: hidden;display:none">
                  <p><u>Room</u></p>
                  <div>
                    <div>
                      <div id="sm-me-room-x-slider" style="display: inline-block"> </div>
                      <div id="sm-me-room-x-val" style="display: inline-block"> </div>
                    </div>


                    <div>
                      <div id="sm-me-room-y-slider" style="display: inline-block"> </div>
                      <div id="sm-me-room-y-val" style="display: inline-block"> </div>
                    </div>

                    <div id="sm-me-tile-selector" style="overflow: hidden;"> </div>


                    <div style="margin: 10px;">
                    <div id="sm-me-undo-button" style=" display: inline-block"> </div>
                    <div id="sm-me-redo-button" style=" display: inline-block"> </div>
                    </div>

                    <div style="margin: 10px;">
                    <div id="sm-me-clear-room-button" style=" display: inline-block"> </div>
                    <div id="sm-me-fill-room-button" style=" display: inline-block"> </div>
                    </div>

                    <div style="margin: 10px;">
                    <div id="sm-me-fill-snake-button" style=" display: inline-block"> </div>
                    <div id="sm-me-fill-loop-button" style=" display: inline-block"> </div>
                    </div>

                    <div style="margin: 10px;">
                    <div id="sm-me-save-room-json-button" style=" display: inline-block"> </div>
                    <div id="sm-me-load-room-json-button" style=" display: inline-block"> </div>
                    </div>

                  </div>
                </div> <!-- End SM ME-->


              </div>
          </div>
        <div class="col-sm-8">
  	     <div id="sketch">
          <div id="canvas-loading-text">
            <p>Canvas is loading.  Please wait.</p>
            <img src="../imgs/loading.gif" style="max-width:320px">
          </div>
        </div>
        </div>
        <!-- <div class="col-sm-3"></div> -->
      </div>
    </section>

    <section class="container" style="padding-top:1rem">
      <div class="row text-center">
        <div class="col-sm-12">
          Github Repo
          <a href="https://github.com/omareq/omareq.github.io/tree/master/line-sim-3d/">
              <img src="../imgs/github-logo.png" alt="Link to github repository"
                   style="max-width:75px">
          </a>
          Docs
          <a href="./docs/" rel="nofollow">
              <img src="../imgs/docs-logo.png" alt="Link to source code documentation"
                   style="max-width:75px">
          </a>
        </div>
      </div>
    </section>


     <section class="container" style="padding-top:2rem">
      <div class="row text-left">
        <div class="col-sm-12">
          <h2> Introduction - The Start of the Line </h2>
          <p>
          Line following is a trial that all roboticists have attempted to
          solve from the hobbyist to the professional.  From one digital light
          sensor to hyper-spectral cameras there are many ways to make a robot
          follow a line.  At the hobbyist level there are many competitions with
          a line following component.  That can be following a line as fast as
          possible or using a line as a means of negotiating a complex
          environment.  This extends to the industrial environment where lines
          are painted on factory floors to guide robots to drop off and pick
          up stock.
          </p>

          <p>
          This simulation has been made to test some simple line following
          algorithms.  As a hobbyist it can be quite difficult to know what
          is important in making a line following robot work.  These parameters
          span the following: light sensor spacing, sensor size, robot speed,
          turning rate and algorithm.  Playing with all of these variables at
          the same time can be quite hard, especially when some of them depend
          on hardware changes.  This simulation provides a simple test bed to
          understand how the choices made can affect how well a robot follows a
          line.
          </p>
          <p>
            This simulation is heavily inspired by
            <a href="https://junior.robocup.org/rcj-rescue-line/">
              RoboCup Junior Rescue Line
            </a>.
            The rules for this competition are always updating and evolving to
            challenge the participants to come up with unique and creative
            solutions. The entire rule set is not implemented here please,
            visit the official website to learn about the current iteration of
            the rules.
          </p>
        </div>
      </div>
    </section>

    <section class="container" style="padding-top:2rem">
      <div class="row text-left">
        <div class="col-sm-12">
          <h2> The Simulation </h2>
          <p>
            This simulation is a model of what is happening in the real world.
            As per the common saying in the scientific community:
            <em>"<a href="https://en.wikipedia.org/wiki/All_models_are_wrong">
            All models are wrong, but some are useful</a>"</em>. This is
            particularly true for this line following simulation.  The following
            section will delve into some of the trade-offs made to ensure that
            the simulation can run in real time whilst maintaining behaviours
            accurate to real line following robots.
          </p>
        </div>
      </div>
    </section>

    <section class="container" style="padding-top:2rem">
      <div class="row text-left">
        <div class="col-sm-8">
        <h5> The Line </h5>
          <p>
            Initially the model for the line was a pixel bitmap showing how much
            of a tile a line occupies.  This was a simple model which produced
            results that were rather realistic.  The real-time constraint for
            this project meant that manipulating images to take sensor readings
            was possibly too slow for the simple analog light sensor case.  A
            series of points is used instead to represent the line.  The Debug
            Static Tile mode will show how every single tile type is represented
            with individual points.  Each tile is constructed with a minimum
            inter-point spacing to ensure that the line is well represented
            which is very important for curved lines.
          </p>
        </div>

        <div class="col-sm-4">
          <!-- Picture of line representation here -->
          <img src="./imgs/vertical-line-representation.webp"
          style="border: 2px solid #888888; max-width: 80%">
          <p> <em>
            Image showing the individual points that represent a line.
          </em></p>
        </div>
      </div>
    </section>

    <section class="container" style="padding-top:2rem">
      <div class="row text-left">
        <div class="col-sm-8">
        <h5> The Sensor </h5>
          <p>
            The main goal of a light sensor in this simulation is to provide a
            some means of measurement to identify where the line is.  There
            are many means to do this using multiple types of sensor.  In this
            simulation the aim will be to model a simple analog light sensor.
            This works by bouncing light off the surface below and seeing how
            much is returned.  The greater the return the higher the voltage
            signal output by the sensor.  This is affected by a series of
            parameters such as the intensity of the light, the height of the
            sensor above the surface and most importantly the material under the
            sensor.  There are a number of assumptions that are made for this
            simulation.
          </p>
        </div>

        <!-- Picture of sensor representation here -->
        <div class="col-sm-4">
          <img src="./imgs/sensor-line-point-distance.webp"
          style="border: 2px solid #888888; max-width: 80%">
          <p> <em>
            Image showing that the light sensor only looks at the closest line
            point.
          </em></p>
        </div>
      </div>
    </section>

    <section class="container" style="padding-top: 2.5rem">
      <div class="row text-left">
        <div class="col-sm-12">
          <h5> Assumptions </h5>
          <ul class="list-group">
            <li class="list-group-item">
              <b> 1) </b>
              There are no external light sources and the onboard light source
              is not fluctuating as is common when lights are powered with
              unstable power supplies.
            </li>

            <li class="list-group-item">
              <b> 2) </b>
              The height of the light sensor above the ground is constant.  This
              means that the area of the circle remains constant all the time.
              This is generally quite difficult to achieve on a robot. Even with
              active suspension maintaining a perfectly stable height is
              unlikely.
            </li>

            <li class="list-group-item">
              <b> 3) </b>
              The material of the background perfectly reflects light in
              a uniform manner across all the tiles in the room.  This will
              return the maximum of 1.0f when the light sensor is fully over the
              background.
            </li>

            <li class="list-group-item">
              <b> 4) </b>
              The material of both the line perfectly absorbs light in
              a uniform manner across all the tiles in the room.  This will
              return the maximum of 0.0f when the light sensor is fully over the
              black line.
            </li>
          </ul>
        </div>
      </div>
    </section>

   <section class="container" style="padding-top:1.5rem">
      <div class="row text-left">
        <div class="col-sm-12">
          In order to estimate the light sensor measurement the light sensor
          looks at the closest point in the line and uses that as the basis for
          all calculations.  The distance between the centre of the line point
          and the centre of the light sensor is calculated.  This distance is
          compared to the line thickness and the sensor radius to figure out how
          much or the sensor is overlapping the line.  This distance is
          calculated independent of the angle to the line.  This manifests as a
          series of circles which are filled black as can be seen in the image
          below.  The closer the circles are together the better the
          approximation to a complete line.  However, no matter how close the
          circles are to each other there will still remain a small gap, this
          ends up causing small jumps in the sensor value.
        </div>
      </div>
    </section>

    <section class="container" style="padding-top:2rem">
      <div class="row text-left">
        <div class="col-sm-3">
          <img src="./imgs/line-point-circles.webp"
          style="border: 2px solid #888888; max-width: 90%">
          <em><p>
            Exaggerated line point spacing showing how lines behave.
          </p></em>
        </div>

        <div class="col-sm-3">
          <img src="./imgs/line-point-circles-filled.webp"
          style="border: 2px solid #888888; max-width: 90%">
          <em><p>
            Condensed line point spacing still showing small gaps at the edges.
          </p></em>
        </div>

        <div class="col-sm-6" >
          <img src="./imgs/line-dist-check-ps-0_25lt-ls-all.webp"
          style="border: 2px solid #888888; max-width: 76%">
          <em><p>
            Graph showing how the light sensor value changes due to the line
            point model.  This effect is reduced at the centre of the line.
          </p></em>
        </div>
      </div>
    </section>

    <section class="container" style="padding-top:2.0rem">
      <div class="row text-left">
        <div class="col-sm-12">
          <p>
            The graph on the right hand side shown above is an example of how
            these spikes in sensor value could appear.  This graph is obtained
            by taking a simple analog sensor and moving it at uniform speed
            along the edge of a line.  The expected value of the light sensor
            reading is 0.5f.  The individual lines shown are for light
            sensors with larger and large radius.  This reduces the effect of
            the gaps between the line points as they take up less area in the
            light sensors field of view.  Similarly if the inter point distance
            is reduced the errors will also be smaller.
          </p>
        </div>
      </div>
    </section>

    <section class="container" style="padding-top:1.5rem">
      <div class="row text-left">
        <div class="col-sm-6">
          <p>
            Whilst these errors are unavoidable they can be quantified more
            precisely to understand if they are acceptable.  For example looking
            at the maximum, minimum and average of the light sensor error for
            all the positions recorded above can provide an understanding of the
            overall performance for a given set of parameters.  This can be seen
            in the following graph.  For example if the light sensor radius and
            the line point separation are the same then there is a less than 5%
            mean error.
          </p>
        </div>
        <div class="col-sm-6">
          <img src="./imgs/line-dist-check-stats-all-percentage.webp"
          style="border: 2px solid #888888; max-width: 98%">
        </div>
      </div>
    </section>

<!--      <section class="container" style="padding-top:10px">
      <div class="row text-left">
        <div class="col-sm-12">
          <h2> One Sensor is All I Need </h2>
        </div>
      </div>
    </section> -->

<!--      <section class="container" style="padding-top:10px">
      <div class="row text-left">
        <div class="col-sm-12">
          <h2> Ok Maybe Two is Better </h2>
        </div>
      </div>
    </section> -->

<!--      <section class="container" style="padding-top:10px">
      <div class="row text-left">
        <div class="col-sm-12">
          <h2> Third Time is the Charm </h2>
        </div>
      </div>
    </section>
 -->
    <div>
      <section class="container" style="padding-top:10px">
        <div class="row text-left">
            <div class="col-sm-12">
              <h2> See Also</h2>
            </div>
        </div>
      </section>
    </div>

    <div>
      <section class="container" style="padding-top:10px">
        <div class="row text-left">
            <div class="col-sm-4">

            <div class="project-card" id="previous">
              <h5 id="prev-title">Maze Sim 3D</h5>
              <a id="prev-url" href="../maze-sim-3d/" class="project-demo">
                <img id="prev-img" src="../imgs/p_023.jpg">
              </a>
            </div>
          </div>

          <div class="col-sm-4">
           <div class="project-card" id="previous">
            <h5 id="prev-title">Quadruped Robot</h5>
            <a id="prev-url" href="../quadruped/" class="project-demo">
              <img id="prev-img" src="../imgs/p_019.jpg">
            </a>
          </div>
        </div>
      </div>
    </section>
  </div>

    <section class="container">
        <div class="row">
            <div class="col-sm-4"></div>
            <div class="col-sm-4">
                <a id="external_link" href="../projects.html" >
                    <img src="../imgs/all-projects-button.jpg" style="max-width: 70%;" alt="Link to all projects page">
                </a>
            </div>
            <div class="col-sm-4"></div>
        </div>
    </section>

    <section class="container">
      <div class="row">
        <div class="col-sm-3">
          <div class="project-card" id="previous">
            <h5 id="prev-title">Hang man</h5>
            <a id="prev-url" href="../hang-man/" class="project-demo">
              <img id="prev-img" src="../imgs/p_026.jpg" onerror="this.onerror=null; this.src='../imgs/p_default.jpg'" alt="Image of the previous project, /**PREV TITLE**/">
            </a>
          </div>
        </div>

        <div class="col-sm-6"></div>

        <div class="col-sm-3">
          <div class="project-card" id="next">
						<h5 id="next-title">Elastic string</h5>
						<a id="next-url" href="../elastic-string/" class="project-demo">
							<img id="next-img" src="../imgs/p_028.jpg" onerror="this.onerror=null; this.src='../imgs/p_default.jpg'">
            </a>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer>
    <div class="links">
        <a href="https://github.com/omareq/" class="github-profile"><span>Github Profile</span></a>
        <a href="../" class="githubio"><span>Github.io Home</span></a>
        <a href="http://iamoquaye.ga/" class="iamoquaye"><span>iamoquaye</span></a>
    </div>
  </footer>

  <script type="text/javascript" id="MathJax-script" async src="../libraries/mathjs-10.6.0.min.js"> </script>
  <!-- p5 v1.9.2 has a problem with callbacks for createButton -->
  <!-- <script language="javascript" type="text/javascript" src="../libraries/p5-1.9.2.min.js"></script> -->
  <script language="javascript" type="text/javascript" src="../libraries/p5.js"></script>
  <script language="javascript" type="text/javascript" src="../libraries/p5.dom.js"></script>
  <script language="javascript" type="text/javascript" src="robot-algorithm.js"></script>
  <script language="javascript" type="text/javascript" src="simulation.js"></script>
  <script language="javascript" type="text/javascript" src="simulation-mode-line-follow-two-sensor.js"></script>
  <script language="javascript" type="text/javascript" src="sketch.js"></script>
  <script async language="javascript" type="text/javascript" src="finite-state-machine.js"></script>
  <script async language="javascript" type="text/javascript" src="simulation-mode-line-follow-three-sensor.js"></script>
  <script async language="javascript" type="text/javascript" src="ui.js"></script>
  <script async language="javascript" type="text/javascript" src="tile-data.js"></script>
  <script async language="javascript" type="text/javascript" src="tile.js"></script>
  <script async language="javascript" type="text/javascript" src="room.js"></script>
  <script async language="javascript" type="text/javascript" src="light-sensor.js"></script>
  <script async language="javascript" type="text/javascript" src="light-sensor-array.js"></script>
  <script async language="javascript" type="text/javascript" src="robot-algorithm-line-follow-three-sensor.js"></script>
  <script async language="javascript" type="text/javascript" src="robot.js"></script>

  <script defer async language="javascript" type="text/javascript" src="simulation-mode-moving-tile.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-static-tile.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-room.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-show-all-tiles.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-light-sensor-array.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-robot.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-one-sensor-line-follow.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-line-distance-check.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-map-editor.js"></script>
  <script defer async language="javascript" type="text/javascript" src="simulation-mode-debug.js"></script>
</body>
</html>